generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// USER MANAGEMENT
// ============================================================================

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  firstName String?   // Added for better user management
  lastName  String?   // Added for better user management
  role      Role      @default(USER)
  isActive  Boolean   @default(true) // Added for user deactivation
  lastLogin DateTime? // Added for admin tracking
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  // Relations
  inquiries       Inquiry[]
  sessions        Session[]
  inquiryActions  InquiryHistory[] // Added for tracking who performed actions
  
  @@index([email])
  @@index([role, isActive])
  @@map("users")
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  sessionId String   @unique
  userAgent String?
  ipAddress String?
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([sessionId])
  @@index([userId])
  @@map("sessions")
}

// ============================================================================
// VEHICLE CATALOG
// ============================================================================

model Category {
  id          String    @id @default(cuid())
  name        String
  slug        String    @unique
  description String?
  image       String?
  metaTitle   String?   // Added for SEO
  metaDescription String? // Added for SEO
  displayOrder Int      @default(0) // Added for custom ordering
  active      Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relations
  vehicles Vehicle[]
  
  @@index([active, displayOrder])
  @@index([slug])
  @@map("categories")
}

model Vehicle {
  id           String    @id @default(cuid())
  name         String
  model        String?   // Added - missing from current schema
  slug         String    @unique
  description  String?
  shortDescription String? // Added for listing pages
  price        Float
  originalPrice Float?   // Added for showing discounts
  images       String[]
  mobileImages String[]  @default([])
  status       Status    @default(AVAILABLE)
  featured     Boolean   @default(false)
  active       Boolean   @default(true)
  categoryId   String
  year         Int?      @default(2024)
  make         String?   @default("Isuzu")
  fuelType     String?   @default("Electric")
  transmission String?
  vin          String?   // Added for vehicle identification
  stockNumber  String?   // Added for inventory management
  views        Int       @default(0) // Added for analytics
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  
  // Relations
  category       Category         @relation(fields: [categoryId], references: [id])
  inquiries      Inquiry[]
  specifications VehicleSpec[]    // Normalized specs instead of JSON
  features       VehicleFeature[] // Normalized features instead of array
  analytics      VehicleAnalytics[] // Added for tracking
  
  @@index([active, featured])
  @@index([categoryId, active])
  @@index([status, active])
  @@index([slug])
  @@index([make, fuelType])
  @@map("vehicles")
}

// Normalized Vehicle Specifications (instead of JSON blob)
model VehicleSpec {
  id        String           @id @default(cuid())
  vehicleId String
  category  SpecCategory     // Performance, Interior, Safety, etc.
  name      String          // "Engine", "Horsepower", "Seating"
  value     String          // "6.7L V8", "450hp", "5 seats"
  unit      String?         // "hp", "L", "seats"
  displayOrder Int          @default(0)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  
  vehicle Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  @@index([vehicleId, category])
  @@index([name, value]) // For filtering by spec values
  @@map("vehicle_specs")
}

// Normalized Vehicle Features (instead of string array)
model VehicleFeature {
  id          String   @id @default(cuid())
  vehicleId   String
  name        String   // "Heated Seats", "Bluetooth", "Backup Camera"
  category    String?  // "Comfort", "Technology", "Safety"
  included    Boolean  @default(true) // vs optional
  displayOrder Int     @default(0)
  createdAt   DateTime @default(now())
  
  vehicle Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  @@index([vehicleId])
  @@index([name])
  @@map("vehicle_features")
}

// Vehicle Analytics for business insights
model VehicleAnalytics {
  id          String          @id @default(cuid())
  vehicleId   String
  eventType   AnalyticsEvent  // VIEW, INQUIRY, FAVORITE
  ipAddress   String?
  userAgent   String?
  referrer    String?
  createdAt   DateTime        @default(now())
  
  vehicle Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  @@index([vehicleId, eventType])
  @@index([createdAt])
  @@map("vehicle_analytics")
}

// ============================================================================
// INQUIRY MANAGEMENT (Enhanced)
// ============================================================================

model Inquiry {
  id           String        @id @default(cuid())
  vehicleId    String?
  userId       String?
  
  // Customer Information (Enhanced)
  customerName String
  firstName    String?       // Split name for better handling
  lastName     String?       // Split name for better handling
  email        String
  phone        String?
  company      String?       // Added for B2B inquiries
  jobTitle     String?       // Added for B2B context
  
  // Inquiry Details
  message      String
  inquiryType  InquiryType   @default(GENERAL) // Added categorization
  priority     Priority      @default(MEDIUM)  // Added priority levels
  source       String?       // "Website", "Phone", "Email", etc.
  budget       Float?        // Added for sales qualification
  timeframe    String?       // "Immediate", "1-3 months", etc.
  
  // Internal Management
  notes        String?
  status       InquiryStatus @default(NEW)
  assignedTo   String?       // User ID of assigned sales rep
  followUpDate DateTime?     // Added for CRM functionality
  closedAt     DateTime?     // Added for reporting
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  
  // Relations
  user           User?            @relation(fields: [userId], references: [id])
  vehicle        Vehicle?         @relation(fields: [vehicleId], references: [id])
  assignedUser   User?            @relation(fields: [assignedTo], references: [id])
  history        InquiryHistory[] // Added for audit trail
  
  @@index([status, priority])
  @@index([vehicleId])
  @@index([assignedTo])
  @@index([email])
  @@index([createdAt])
  @@map("inquiries")
}

// New: Inquiry History for audit trail
model InquiryHistory {
  id        String    @id @default(cuid())
  inquiryId String
  userId    String?   // Who performed the action
  action    String    // "STATUS_CHANGED", "NOTE_ADDED", "ASSIGNED", etc.
  oldValue  String?   // Previous value
  newValue  String?   // New value
  comment   String?   // Optional comment
  createdAt DateTime  @default(now())
  
  inquiry Inquiry @relation(fields: [inquiryId], references: [id], onDelete: Cascade)
  user    User?   @relation(fields: [userId], references: [id])
  
  @@index([inquiryId])
  @@index([createdAt])
  @@map("inquiry_history")
}

// ============================================================================
// CONTENT MANAGEMENT (Optimized)
// ============================================================================

model HomepageContent {
  id                    String   @id @default(cuid())
  
  // Hero Section
  heroTitle             String   @default("Premium Commercial Vehicles")
  heroSubtitle          String   @default("Electric Fleet Solutions")
  heroDescription       String   @default("Discover elite fleet solutions built for businesses that demand excellence.")
  heroButtonPrimary     String   @default("Explore Fleet")
  heroButtonSecondary   String   @default("Get Quote")
  heroBackgroundImage   String?  // Added hero background
  heroBackgroundImageMobile String? // Added mobile hero background
  
  // Statistics Section
  happyClients          Int      @default(25)
  yearsExperience       Int      @default(10)
  satisfactionRate      Int      @default(95)
  totalVehiclesSold     Int      @default(150) // Moved from company info for consistency
  
  // Partners Section
  partnersTitle         String   @default("Trusted by Industry Leaders")
  partnersDescription   String   @default("We partner with respected manufacturers.")
  
  // Features Section
  feature1Title         String   @default("Quality Guarantee")
  feature1Description   String   @default("Rigorous inspection and warranty coverage.")
  feature1Icon          String   @default("shield") // Added icons
  
  feature2Title         String   @default("Fast Delivery")
  feature2Description   String   @default("Quick processing and delivery.")
  feature2Icon          String   @default("truck")
  
  feature3Title         String   @default("24/7 Support")
  feature3Description   String   @default("Round-the-clock customer support.")
  feature3Icon          String   @default("headphones")
  
  // Coming Soon Section
  comingSoonImage       String   @default("/images/coming-soon.jpg")
  comingSoonImageAlt    String   @default("Coming Soon")
  comingSoonImageMobile String?  @default("/images/coming-soon-mobile.jpg")
  comingSoonTitle       String   @default("Exciting Updates Coming Soon") // Added title
  comingSoonDescription String?  // Added description
  
  // Section Visibility Controls
  showComingSoonSection Boolean  @default(true)
  showHeroSection       Boolean  @default(true)
  showVehicleCategories Boolean  @default(true)
  showFeaturedVehicles  Boolean  @default(true)
  showTrustSection      Boolean  @default(true)
  showStatsSection      Boolean  @default(true) // Added stats control
  showPartnersSection   Boolean  @default(true) // Added partners control
  
  // SEO
  metaTitle             String?
  metaDescription       String?
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  @@index([updatedAt])
  @@map("homepage_content")
}

model CompanyInfo {
  id                  String   @id @default(cuid())
  
  // Basic Information
  companyName         String   @default("EVTL")
  companyDescription  String   @default("Leading provider of electric commercial vehicles.")
  companyDescription2 String   @default("Specialized fleet solutions for modern businesses.")
  logo                String?  // Added logo field
  
  // Company Details
  foundedYear         Int      @default(1998)
  totalHappyCustomers Int      @default(850)
  totalYearsExp       Int      @default(25)
  satisfactionRate    Int      @default(98)
  employeeCount       Int?     // Added employee count
  
  // Story Content
  storyTitle          String   @default("Our Story")
  storyParagraph1     String   @default("Founded with a vision...")
  storyParagraph2     String   @default("Built on quality and trust...")
  storyParagraph3     String   @default("Leading into the future...")
  
  // Mission & Vision
  missionTitle        String   @default("Our Mission")
  missionText         String   @default("Empowering businesses with sustainable transport.")
  visionTitle         String   @default("Our Vision")
  visionText          String   @default("Zero-emission commercial transportation future.")
  
  // Values (consolidated from separate model)
  coreValues          Json?    // Array of {title, description, icon}
  
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@map("company_info")
}

model ContactInfo {
  id                  String   @id @default(cuid())
  
  // Contact Details
  salesPhone          String   @default("+60 10 339 1414")
  servicePhone        String   @default("+60 16 332 2349")
  financePhone        String   @default("+60 16 332 2349")
  salesEmail          String   @default("sales@evtl.com.my")
  serviceEmail        String   @default("service@evtl.com.my")
  supportEmail        String   @default("support@evtl.com.my")
  
  // Address Information
  address             String   @default("3-20 Level 3 MKH Boulevard, Jalan Changkat")
  city                String   @default("Kajang")
  state               String   @default("Selangor")
  postcode            String   @default("43000")
  country             String   @default("Malaysia")
  directions          String   @default("EVTL Trucks Office")
  latitude            Float?   // Added for maps integration
  longitude           Float?   // Added for maps integration
  
  // Business Hours
  mondayToFriday      String   @default("9:00 AM - 6:00 PM")
  saturday            String   @default("9:00 AM - 1:00 PM")
  sunday              String   @default("Closed")
  
  // Website Settings
  siteName            String   @default("EVTL")
  companyDescription  String   @default("Next-generation mobility startup focusing on Electric Trucks.")
  
  // Social Media
  facebookUrl         String   @default("")
  twitterUrl          String   @default("")
  instagramUrl        String   @default("")
  linkedinUrl         String   @default("")
  youtubeUrl          String?  // Added YouTube
  
  // Legal Pages
  privacyPolicyUrl    String   @default("/privacy")
  termsOfServiceUrl   String   @default("/terms")
  
  // System Settings
  emailNotifications  Boolean  @default(true)
  systemNotifications Boolean  @default(true)
  maintenanceMode     Boolean  @default(false)
  
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@map("contact_info")
}

model TechnologyContent {
  id                     String   @id @default(cuid())
  
  // Hero Section
  heroTitle              String   @default("Next-Generation Electric Technology")
  heroSubtitle           String   @default("Advanced EV technology for commercial success")
  heroBackgroundImage    String   @default("/uploads/technology-hero.png")
  heroBackgroundImageAlt String   @default("Electric Truck Technology")
  
  // Technology Sections
  section1Title          String   @default("Advanced Battery Technology")
  section1Description    String   @default("Exceptional range and durability for commercial use.")
  section1Image          String?  // Added section images
  section1Icon           String   @default("battery")
  
  section2Title          String   @default("Smart Fleet Management")
  section2Description    String   @default("IoT solutions for monitoring and optimization.")
  section2Image          String?
  section2Icon           String   @default("wifi")
  
  section3Title          String   @default("Rapid Charging Infrastructure")
  section3Description    String   @default("Fast-charging to minimize downtime.")
  section3Image          String?
  section3Icon           String   @default("zap")
  
  section4Title          String   @default("Sustainable Manufacturing")
  section4Description    String   @default("Eco-friendly production processes.")
  section4Image          String?
  section4Icon           String   @default("leaf")
  
  // Additional Features (normalized from separate model)
  additionalFeatures     Json?    // Array of {title, description, icon}
  
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  
  @@map("technology_content")
}

// ============================================================================
// CONFIGURATION & FILTERS (Optimized)
// ============================================================================

model FilterOption {
  id        String   @id @default(cuid())
  type      String   // "fuelType", "transmission", "make", etc.
  value     String   // "Electric", "Manual", "Isuzu"
  label     String   // Display name
  order     Int      @default(0)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([type, value])
  @@index([type, active, order])
  @@map("filter_options")
}

// ============================================================================
// ANALYTICS & REPORTING (New)
// ============================================================================

model BusinessMetrics {
  id              String          @id @default(cuid())
  metricType      BusinessMetric  // DAILY_INQUIRIES, WEEKLY_VIEWS, etc.
  value           Float
  date            DateTime        // Date of the metric
  additionalData  Json?           // Extra context data
  createdAt       DateTime        @default(now())
  
  @@index([metricType, date])
  @@index([date])
  @@map("business_metrics")
}

// ============================================================================
// ENUMS
// ============================================================================

enum Role {
  ADMIN
  MANAGER
  SALES_REP
  USER
}

enum Status {
  AVAILABLE
  RESERVED
  SOLD
  MAINTENANCE
}

enum InquiryStatus {
  NEW
  CONTACTED
  QUALIFIED
  PROPOSAL_SENT
  NEGOTIATING
  CLOSED_WON
  CLOSED_LOST
  RESOLVED
}

enum InquiryType {
  GENERAL
  PURCHASE
  SERVICE
  FINANCING
  LEASING
  PARTS
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum SpecCategory {
  PERFORMANCE
  INTERIOR
  SAFETY
  EXTERIOR
  TECHNOLOGY
  DIMENSIONS
  CAPACITY
}

enum AnalyticsEvent {
  VIEW
  INQUIRY
  FAVORITE
  SHARE
  BROCHURE_DOWNLOAD
}

enum BusinessMetric {
  DAILY_INQUIRIES
  WEEKLY_VIEWS
  MONTHLY_SALES
  CONVERSION_RATE
  POPULAR_VEHICLES
  TOP_CATEGORIES
}